#!/bin/sh

# Arin.Ga - Pastebin

# This script sends a POST request with curl
# The url is printed to stdout and copied to the X clipboard
# More info at http://arin.ga/000002

if ! command -v curl > /dev/null 2>&1; then
  printf "%s: Upload failure: %s\n" "$0" "curl is not installed" >&2
  exit 1
fi

ret=0 clipboard=
if [ "$#" = 0 ] ; then
  if ! url=$(curl --silent -F "aringa=<-" http://arin.ga) ; then
    printf "%s: Upload failure\n" "$0" >&2
    exit 1
  else
    printf "%s\n" "$url"
    clipboard=$url
  fi 
else 
  for file; do
    if ! url=$(curl --silent -F "aringa=<$file" http://arin.ga) ; then
      printf "%s: Upload failure: %s\n" "$0" "$file" >&2
      ret=1
    else
      printf "%s\n" "$url"
      if [ "$clipboard" ]; then
        clipboard="$clipboard
$url"
      else clipboard=$url
      fi
    fi 
  done
fi

if [ "$DISPLAY" ] ; then
  { command -v xsel > /dev/null 2>&1 && echo "$clipboard" | xsel; } || 
  { command -v xclip > /dev/null 2>&1 && echo "$clipboard" | xclip; }
fi
exit "$ret"

